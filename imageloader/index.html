<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Meta, title, CSS, favicons, etc. -->
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="description" content="A android development framework. It makes loading image and network request easy.">


<meta name="keywords" content="Cube-SDK, Android development framework, Image Loader, Easy netwrok request.">

<meta name="author" content="liaohuqiu@gmail.com">

<title>
  
  Image Loader &middot; Cube SDK
  
</title>

<!-- Bootstrap core CSS -->
<link href="/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- Documentation extras -->
<link href="/assets/css/docs.min.css" rel="stylesheet">
<link href="/assets/css/app.css" rel="stylesheet">
<!--[if lt IE 9]><script src="../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->

<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
  <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<!-- Favicons -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/ico/apple-touch-icon-144-precomposed.png">
<link rel="shortcut icon" href="/assets/ico/favicon.ico">

<script>
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-43024238-2']);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>


  </head>
  <body>
    <a class="sr-only" href="#content">Skip to main content</a>

    <!-- Docs master nav -->
    <header class="navbar navbar-static-top bs-docs-nav" role="banner">
    <div class="container">
        
        <div class="navbar-header">
            <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".bs-navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="/" class="navbar-brand">Cube</a>
        </div>
        <nav class="collapse navbar-collapse bs-navbar-collapse" role="navigation">
            <ul class="nav navbar-nav">
                
                <li>
                <a href="/imageloader">Image Loader</a>
                </li>
                
                <li>
                <a href="/request">Request</a>
                </li>
                
                <li>
                <a href="/request-cache">Cache for Request</a>
                </li>
                
                <li>
                <a href="/views">Component Views</a>
                </li>
                
                <li>
                <a href="/javadoc">Javadoc</a>
                </li>
                
            </ul>
            <ul class="nav navbar-nav navbar-right">
                
                <li>
                <a href="/">English</a>
                </li>
                
                <li>
                <a href="/cn">简体中文</a>
                </li>
                
                <li>
                <a href="https://github.com/liaohuqiu/cube-sdk">Fork on Github</a>
                </li>
                
            </ul>
        </nav>
    </div>
</header>


    <!-- Docs page layout -->
    <div class="bs-header" id="content">
      <div class="container">
        <h1>Image Loader</h1>
        <p>Make Loading Image Efficiently & Easily.</p>
      </div>
    </div>

    <div class="container bs-docs-container">

      <div class="row">
        <div class="col-md-9" role="main">
          <h1 id="imageloader">ImageLoader</h1>

<hr>

<p class='lead'>The <code>ImageLoader</code>, it is...</p>

<h1 id="simple-usage">Simple Usage</h1>

<hr>

<p class='lead'>It is very simple to use <code>ImageLoader</code>.</p>

<ol>
<li><p>First, create an <code>ImageLoader</code>:</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">Context</span> <span class="n">context</span><span class="o">;</span>
<span class="n">ImageLoader</span> <span class="n">imageLoader</span> <span class="o">=</span> <span class="n">ImageLoaderFatory</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
</code></pre></div></li>
<li><p>Find the ImageView in which the image will be loaded.</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">CubeImageView</span> <span class="n">imageView</span> <span class="o">=</span> <span class="o">(</span><span class="n">CubeImageView</span><span class="o">)</span> <span class="n">view</span><span class="o">.</span><span class="na">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">iv_item_image_list_big</span><span class="o">);</span>
</code></pre></div>
<p><code>CubeImageView</code> is a subclass of <code>ImageView</code>, the layout file maybe like:</p>
<div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class="nt">&lt;LinearLayout</span> <span class="na">xmlns:android=</span><span class="s">&quot;http://schemas.android.com/apk/res/android&quot;</span>
    <span class="na">android:layout_width=</span><span class="s">&quot;wrap_content&quot;</span>
    <span class="na">android:layout_height=</span><span class="s">&quot;wrap_content&quot;</span>
    <span class="na">android:orientation=</span><span class="s">&quot;vertical&quot;</span> <span class="nt">&gt;</span>

    <span class="nt">&lt;in.srain.cube.image.CubeImageView</span>
        <span class="na">android:id=</span><span class="s">&quot;@+id/iv_item_image_list_big&quot;</span>
        <span class="na">android:layout_width=</span><span class="s">&quot;match_parent&quot;</span>
        <span class="na">android:layout_height=</span><span class="s">&quot;match_parent&quot;</span>
        <span class="na">android:scaleType=</span><span class="s">&quot;fitCenter&quot;</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;/LinearLayout&gt;</span>
</code></pre></div></li>
<li><p>Use the ImageView and the ImageLoader to load image</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">String</span> <span class="n">url</span> <span class="o">=</span> <span class="err">&#39;&#39;</span><span class="o">;</span>
<span class="n">imageView</span><span class="o">.</span><span class="na">loadImage</span><span class="o">(</span><span class="n">imageLoader</span><span class="o">,</span> <span class="n">url</span><span class="o">);</span>
</code></pre></div></li>
</ol>

<h1 id="how-does-it-work">How does it work</h1>

<hr>

<p class='lead'>The process of loading a bitmap is also very simple.</p>

<h2 id="workflow">Workflow</h2>

<ol>
<li> If image has been loaded, it will not be loaded again.</li>
<li> Check if the image is in memory cache, if yes, display it.</li>
<li><p>An <code>ImageTask</code> is created, then added to <code>ImageLoader</code>. The <code>ImageTaskExecutor</code> will take it.</p>

<p><code>ImageTaskExecutor</code> has an work queue, it has some threads to do the work in backgroud. If all of the threads are busy with current task, this task will put into the work queue.</p></li>
<li><p>If the image is stored in file cache, it will be decoded, or else <code>ImageProvider</code> will fetch it from remote server then store it to file cache.</p></li>
<li><p>After decoded, the process is complete. The ImageView will be notified to display this image.</p></li>
</ol>
<div class="highlight"><pre><code class="language-text" data-lang="text">                                           Work Flow       
</code></pre></div><div class="highlight"><pre><code class="language-text" data-lang="text">           | start
           v
+-----------------------+                                                                
|                       |             Y                                                  
|  loaded or loading ?  +-----------------------------+                                  
|                       |                             |                                  
+----------+------------+                             |                                  
           | N                                        v                                  
           v                                          |                                  
+-----------------------+                             |      +--------------------------+
|                       |             Y               |      |                          |
|  in memeory cache ?   +------------------------&gt;----+----&gt; |  display                 |
|                       |                             |      |                          |
+----------+------------+                             |      ---------------------------+
           | N                                        |                                  
           v                                          ^                                  
+-----------------------+                             |                                  
|                       |             Y               |                                  
|  in file cache ?      +-------------------------+   |                                  
|                       |                         |   |                                  
+----------+------------+                         |   |                                   
           | N                                    |   |                                   
           v                                      v   |                                   
+-----------------------+      +----------+     +-----+--+     +------------------------+ 
|                       |      |          |     |        |     |                        |
|  not in any cache     +----&gt; | download +---&gt; | decode +---&gt; | save to cache          | 
|                       |      |          |     |        |     |                        |
+-----------------------+      +----------+     +--------+     +------------------------+
</code></pre></div>
<h2 id="the-schema">The Schema</h2>
<div class="highlight"><pre><code class="language-text" data-lang="text">                                           Cube ImageLoader
</code></pre></div><div class="highlight"><pre><code class="language-bash" data-lang="bash">   +-----------------+        +-----------------------+      +--------------------------+    
   <span class="p">|</span> CubeImageView   <span class="p">|</span>        <span class="p">|</span> ImageTask             <span class="p">|</span>      <span class="p">|</span>  ImageViewHodler         <span class="p">|</span>    
   <span class="p">|</span>   +             +-------&gt;<span class="p">|</span>   +                   <span class="p">|</span>      <span class="p">|</span>    +                     <span class="p">|</span>    
   <span class="p">|</span>   +- loadImage  <span class="p">|</span>        <span class="p">|</span>   +- addImageView     <span class="p">|</span>      <span class="p">|</span>    +- mNext              <span class="p">|</span>    
   <span class="p">|</span>   +- ImageTask  <span class="p">|</span>        <span class="p">|</span>   +- removeImageView  +-----&gt;<span class="p">|</span>    +- mPrev              <span class="p">|</span>    
   +-----------------+        <span class="p">|</span>   +- getIdentityUrl   <span class="p">|</span>      <span class="p">|</span>                          <span class="p">|</span>    
                              <span class="p">|</span>   <span class="p">|</span>                   <span class="p">|</span>      +--------------------------+    
            +---------------- +   +- ImageViewHolder  <span class="p">|</span>                                      
            <span class="p">|</span>                 +-----------------------+                                      
            v                                                                                
+----------------------------+      +-------------------+                                    
<span class="p">|</span> ImageLoader                <span class="p">|</span>      <span class="p">|</span> ImageHandler      <span class="p">|</span>                                    
<span class="p">|</span>   +                        <span class="p">|</span>      <span class="p">|</span>   +               <span class="p">|</span>                                    
<span class="p">|</span>   +- queryCache            +-----&gt;<span class="p">|</span>   +- onLoading    <span class="p">|</span>                                    
<span class="p">|</span>   +- addTask               <span class="p">|</span>      <span class="p">|</span>   +- onLoadFinish <span class="p">|</span>                                    
<span class="p">|</span>   <span class="p">|</span>                        <span class="p">|</span>      <span class="p">|</span>   +- onLoadError  <span class="p">|</span>                                    
<span class="p">|</span>   +- stopWork              <span class="p">|</span>      +-------------------+                                    
<span class="p">|</span>   +- recoverWork           <span class="p">|</span>                                                               
<span class="p">|</span>   +- pasueWork             <span class="p">|</span>      +---------------------+   +------------------------+     
<span class="p">|</span>   +- resumeWork            <span class="p">|</span>      <span class="p">|</span> LoadImageTask       <span class="p">|</span>   <span class="p">|</span> SimpleImageTask        <span class="p">|</span>     
<span class="p">|</span>   <span class="p">|</span>                        +-----&gt;<span class="p">|</span>   +                 +--&gt;<span class="p">|</span>   +                    <span class="p">|</span>     
<span class="p">|</span>   +- ImageProvider         <span class="p">|</span>      <span class="p">|</span>   +- doInBackground <span class="p">|</span>   <span class="p">|</span>   +- doInBackground    <span class="p">|</span>     
<span class="p">|</span>   +- ImageTaskExecutor     <span class="p">|</span>      +------------------+--+   <span class="p">|</span>   +- onFinish          <span class="p">|</span>     
<span class="p">|</span>   +- ImageResizer          <span class="p">|</span>                         <span class="p">|</span>      <span class="p">|</span>   +- onCancle          <span class="p">|</span>     
<span class="p">|</span>   +- ImageHandler          <span class="p">|</span>                         <span class="p">|</span>      <span class="p">|</span>   +- canchel           <span class="p">|</span>     
+------------+-----------+---+                         <span class="p">|</span>      +------------------------+     
             <span class="p">|</span>           <span class="p">|</span>                             <span class="p">|</span>                                     
             v           +-------------------+         <span class="p">|</span>                                     
+-------------------------------+            <span class="p">|</span>         <span class="p">|</span>                                     
<span class="p">|</span> ImageProvider                 <span class="p">|</span>            v         v                                     
<span class="p">|</span>   +                           <span class="p">|</span>        +----------------------+                            
<span class="p">|</span>   +- getBitmapFromMemCache    <span class="p">|</span>        <span class="p">|</span>  ImageTaskExecutor   <span class="p">|</span>                            
<span class="p">|</span>   +- fetchBitmapData          <span class="p">|</span>        <span class="p">|</span>   +                  <span class="p">|</span>                            
<span class="p">|</span>   +                           <span class="p">|</span>        <span class="p">|</span>   +- execute         <span class="p">|</span>                            
<span class="p">|</span>   +- MemoryCache              <span class="p">|</span>        <span class="p">|</span>   +- setTaskOrder    <span class="p">|</span>                            
<span class="p">|</span>   +- ImageDownLoader          <span class="p">|</span>        +----------------------+                            
<span class="p">|</span>   +- FileCache                <span class="p">|</span>                                                            
+------+-------------------+--+-+                                                            
       <span class="p">|</span>                   <span class="p">|</span>  <span class="p">|</span>                                                              
       <span class="p">|</span>                   <span class="p">|</span>  +--------------+                                               
       v                   v                 v                                               
+----------------+  +---------------+   +---------------+                                    
<span class="p">|</span> LRUMemoryCache <span class="p">|</span>  <span class="p">|</span> LRUFileCache  <span class="p">|</span>   <span class="p">|</span> Downloader    <span class="p">|</span>                                    
+----------------+  +---------------+   +---------------+                                    
</code></pre></div>
<h2 id="components">Components</h2>

<p>There are four components used in <code>ImageLoader</code> to load image. As you can see in the construct method in the <code>ImageLoader</code>:</p>

<ul>
<li><p><code>ImageLoader</code></p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="nf">ImageLoader</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> 

                        <span class="n">ImageProvider</span> <span class="n">provider</span><span class="o">,</span> 
                        <span class="n">ImageTaskExecutor</span> <span class="n">executor</span><span class="o">,</span> 
                        <span class="n">ImageResizer</span> <span class="n">resizer</span><span class="o">,</span> 
                        <span class="n">ImageLoadHandler</span> <span class="n">loadHandler</span><span class="o">)</span> <span class="o">{</span>

<span class="o">}</span>
</code></pre></div></li>
</ul>

<p>They are:</p>

<ul>
<li><p><code>ImageProvider</code></p>

<p>It managers the <code>ImageMemoryCache</code> and <code>ImageFileCache</code>; request the image from remote server; decode bitmap from file.</p></li>
<li><p><code>ImageTaskExexutor</code></p>

<p>It is an interface which extends <code>ava.util.concurrent.Executor</code>. An <code>ImageTaskExecutor</code> can execute <code>LoadImageTask</code>, it allows the task can be executed in different order.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">void setTaskOrder(ImageTaskOrder order);
void execute(Runnable command);
</code></pre></div></li>
<li><p><code>ImageResizer</code></p>

<p>It controls the <code>BitmapFactory.Options.inSampleSize</code> when decode bitmap from file and builds the network url according the request size.</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">int getInSampleSize(ImageTask imageTask);
String getResizedUrl(ImageTask imageTask);
</code></pre></div></li>
<li><p><code>ImageLoadHandler</code></p>
<div class="highlight"><pre><code class="language-text" data-lang="text">void onLoading(ImageTask imageTask, CubeImageView cubeImageView);
void onLoadFinish(ImageTask imageTask, CubeImageView cubeImageView, BitmapDrawable drawable);
</code></pre></div>
<p>When the image is loading in the backgroud thread, <code>onLoading()</code> will be called to notify the ImageView. The ImageView can display a loading image place hodler. </p>

<p>Once image is loaded, <code>onLoadFinish()</code> will be called to notify the ImageView to display the image.</p></li>
</ul>

<h1 id="customize">Customize</h1>

<p class='lead'>Most of the components interface has a default implementions, you can implement for your own application.</p>

<h3 id="a-speical-loading-image">A speical loading image</h3>

<p>There are lots of ways:</p>

<ol>
<li><p>Implement the interface <code>ImageLoadHandler</code>;</p></li>
<li><p>Use the <code>DefaultImageLoadHandler</code> which implements <code>ImageLoadHandler</code>:</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">DefaultImageLoadHandler</span> <span class="n">handler</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">DefaultImageLoadHandler</span><span class="o">();</span>

<span class="c1">// pick one of the following method</span>
<span class="n">handler</span><span class="o">.</span><span class="na">setLoadingBitmap</span><span class="o">(</span><span class="n">Bitmap</span> <span class="n">loadingBitmap</span><span class="o">);</span>
<span class="n">handler</span><span class="o">.</span><span class="na">setLoadingResources</span><span class="o">(</span><span class="kt">int</span> <span class="n">loadingBitmap</span><span class="o">);</span>
<span class="n">handler</span><span class="o">.</span><span class="na">setLoadingImageColor</span><span class="o">(</span><span class="kt">int</span> <span class="n">color</span><span class="o">);</span>
<span class="n">handler</span><span class="o">.</span><span class="na">setLoadingImageColor</span><span class="o">(</span><span class="n">String</span> <span class="n">colorString</span><span class="o">);</span>
</code></pre></div></li>
</ol>

<h3 id="some-speical-effect-after-the-image-is-loaded">Some speical effect after the image is loaded</h3>

<ol>
<li><p>You can also implement the <code>ImageLoadHandler</code>, in the <code>onLoadFinish()</code> method, you can add whatever effect you want, as long as they are based on <code>Drawable</code>.</p></li>
<li><p>In the <code>DefaultImageLoadHandler</code>, there are some effects;</p>

<ul>
<li><p><strong>Fade in</strong> by default, this effect is on.</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">setImageFadeIn</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">fadeIn</span><span class="o">);</span>
</code></pre></div></li>
<li><p><strong>Rounded corner</strong></p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="n">setImageRounded</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">rouded</span><span class="o">,</span> <span class="kt">float</span> <span class="n">cornerRadius</span><span class="o">);</span>
</code></pre></div></li>
</ul></li>
</ol>

<h3 id="diffrent-url-for-diffrent-size">Diffrent url for diffrent size</h3>

<p>If you have a thumbnail web service which can return multiple size image according the url, you can implements this method to return the specified url according the request size.</p>

<p>That is easy:</p>
<div class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">EtaoImageResizer</span> <span class="kd">extends</span> <span class="n">DefaultResizer</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getResizedUrl</span><span class="o">(</span><span class="n">ImageTask</span> <span class="n">imageTask</span><span class="o">)</span> <span class="o">{</span>

            <span class="kt">int</span> <span class="n">w</span> <span class="o">=</span> <span class="n">imageTask</span><span class="o">.</span><span class="na">getRequestSize</span><span class="o">().</span><span class="na">x</span><span class="o">;</span>
            <span class="kt">int</span> <span class="n">h</span> <span class="o">=</span> <span class="n">imageTask</span><span class="o">.</span><span class="na">getRequestSize</span><span class="o">().</span><span class="na">y</span><span class="o">;</span>

            <span class="c1">// return url according the request size</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div>
<h1 id="advance">Advance</h1>

<h3 id="reuse-of-image">Reuse of Image</h3>

<ul>
<li>ReuseInfo</li>
<li>load image with <code>ReuseInfo</code></li>
</ul>

        </div>
        <div class="col-md-3">
          <div class="bs-sidebar hidden-print" role="complementary">
            <ul class="nav bs-sidenav">
                <!-- auto gen -->
            </ul>
          </div>
        </div>
      </div>

    </div>

    <!-- Footer
================================================== -->
<footer class="bs-footer" role="contentinfo">
  <div class="container">
    <ul class="footer-links muted">
      <li>Document framework powered by <a href="http://bt-docs.liaohuqiu.net">Bt-docs</a></li>
      <li>&middot;</li>
      <li>Proudly hosted by <a href="https://pages.github.com">Github Pages</a></li>
    </ul>
  </div>
</footer>

<!-- Bootstrap core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="/assets/js/jquery.min.js"></script>
<script src="/dist/js/bootstrap.min.js"></script>
<script src="/assets/js/docs.min.js"></script>

  </body>
</html>
